<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin â€“ Overview</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: 2rem auto; }
    table { width: 100%; border-collapse: collapse; }
    td, th { border: 1px solid #ccc; padding: 0.4rem; }
    input, button { padding: 0.4rem; margin-top: 0.5rem; }
  </style>
</head>
<body>

<h2>Admin</h2>

<div id="login">
  <input id="pw" type="password" placeholder="Admin password" />
  <button onclick="login()">Login</button>
</div>

<div id="content" style="display:none">
  <h3>Who has what</h3>
  <table id="table">
    <tr><th>Item</th><th>Current holder</th><th>Since</th></tr>
  </table>

  <h3>Predefined names</h3>
  <input id="newName" placeholder="Name" />
  <button onclick="addName()">Add</button>

  <ul id="names"></ul>
</div>

<script>
  // ---- Replace these with your Supabase credentials ----
  const SUPABASE_URL = "https://fmaoikmmenyxkocwpakx.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZtYW9pa21tZW55eGtvY3dwYWt4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwNTc1NjIsImV4cCI6MjA4NTYzMzU2Mn0.Z8iJm6nbDiFggzu_2XIiIbSp5qjjb8HMTTr1DI-OPNE";
  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  async function login() {
    const pw = document.getElementById("pw").value;
    const { data } = await sb.from("settings").select("value").eq("key","admin_password").single();

    if (data && data.value === pw) {
      document.getElementById("login").style.display = "none";
      document.getElementById("content").style.display = "block";
      load();
    } else {
      alert("Wrong password");
    }
  }

  async function load() {
    // Populate table "Who has what"
    const { data: items } = await sb.from("items").select("*");
    const table = document.getElementById("table");
    table.innerHTML = "<tr><th>Item</th><th>Current holder</th><th>Since</th></tr>";
    items.forEach(i => {
      const row = document.createElement("tr");
      row.innerHTML = `<td>${i.name}</td><td>${i.current_holder || "-"}</td><td>${i.updated_at || "-"}</td>`;
      table.appendChild(row);
    });

    // Populate known names
    const { data: names } = await sb.from("known_names").select("*");
    const ul = document.getElementById("names");
    ul.innerHTML = "";
    names.forEach(n => {
      const li = document.createElement("li");
      li.innerText = n.name;
      ul.appendChild(li);
    });
  }

  async function addName() {
    const name = document.getElementById("newName").value.trim();
    if (!name) return;
    await sb.from("known_names").insert({ name });
    load();
  }
</script>

</body>
</html>

